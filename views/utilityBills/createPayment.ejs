<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Process Payment Utility Bill</title>
    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
  </head>
  <body>
    <div class="container mt-4">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <!-- Header -->
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white">
              <h4 class="mb-0">Process Payment Utility Bill</h4>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <p><strong>Building:</strong> <%= utils.bldg_name %></p>
                  <p><strong>Unit:</strong> <%= utils.unit_no %></p>
                  <p><strong>Owner:</strong> <%= utils.owner_name %></p>
                </div>
                <div class="col-md-6">
                  <p>
                    <strong>Period:</strong>
                    <%= new Date(utils.start_date).toLocaleDateString() %> - <%=
                    new Date(utils.end_date).toLocaleDateString() %>
                  </p>
                  <p>
                    <strong>Due Date:</strong>
                    <%= new Date(utils.due_date).toLocaleDateString() %>
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Payment Summary -->
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-info text-white">
              <h5 class="mb-0">Payment Summary</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-4">
                  <div class="text-center p-3 border rounded bg-light">
                    <h6 class="text-muted">Total Amount</h6>
                    <h4 class="text-dark">
                      ₱<%= parseFloat(utils.total_amt).toLocaleString('en-PH',
                      {minimumFractionDigits: 2}) %>
                    </h4>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="text-center p-3 border rounded bg-light">
                    <h6 class="text-muted">Amount Paid</h6>
                    <h4 class="text-success">
                      ₱<%= parseFloat(utils.amt_paid ||
                      0).toLocaleString('en-PH', {minimumFractionDigits: 2}) %>
                    </h4>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="text-center p-3 border rounded bg-light">
                    <h6 class="text-muted">Remaining Balance</h6>
                    <h4 class="text-danger">
                      ₱<%=
                      parseFloat(utils.remaining_balance).toLocaleString('en-PH',
                      {minimumFractionDigits: 2}) %>
                    </h4>
                  </div>
                </div>
              </div>

              <!-- Current Status -->
              <div class="mt-3 text-center">
                <span
                  class="badge fs-6 <% if (utils.status === 'paid') { %>bg-success<% } else if (utils.status === 'partial') { %>bg-warning<% } else { %>bg-danger<% } %>"
                >
                  Status: <%= utils.status.toUpperCase() %>
                </span>
              </div>
            </div>
          </div>

          <!-- Payment Form -->
          <% if (utils.remaining_balance > 0) { %>
          <div class="card shadow-sm">
            <div class="card-header bg-success text-white">
              <h5 class="mb-0">Record Payment</h5>
            </div>
            <div class="card-body">
              <form
                action="/utilityBills/createPayment/<%= utils.util_id %>"
                method="POST"
                id="paymentForm"
              >
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="payment_amount" class="form-label">
                        Payment Amount
                      </label>
                      <div class="input-group">
                        <span class="input-group-text">₱</span>
                        <input
                          type="number"
                          class="form-control"
                          id="payment_amount"
                          name="payment_amount"
                          min="1.00"
                          required
                        />
                      </div>
                      <div class="form-text">
                        Maximum: ₱<%=
                        parseFloat(utils.remaining_balance).toLocaleString('en-PH',
                        {minimumFractionDigits: 2}) %>
                      </div>
                    </div>

                    <div class="mb-3">
                      <label for="date_paid" class="form-label"
                        >Payment Date</label
                      >
                      <input
                        type="date"
                        class="form-control"
                        id="date_paid"
                        name="date_paid"
                        required
                      />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="ack_no" class="form-label">
                        Acknowledgment Number
                      </label>
                      <input
                        type="text"
                        class="form-control"
                        id="ack_no"
                        name="ack_no"
                        placeholder="Enter Acknowledgement number"
                        required
                      />
                      <div class="form-text">
                        Reference number from payment receipt
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Action Buttons -->
                <div class="d-flex justify-content-between">
                  <a
                    href="/utilityBills/<%= utils.unit_id %>"
                    class="btn btn-secondary"
                  >
                    ← Back to Bills
                  </a>
                  <button type="submit" class="btn btn-success">
                    ✓ Process Payment
                  </button>
                </div>
              </form>
            </div>
          </div>
          <% } else { %>
          <div class="card shadow-sm">
            <div class="card-body text-center">
              <div class="text-success mb-3" style="font-size: 4rem">✓</div>
              <h4 class="text-success">Fully Paid</h4>
              <p class="text-muted">This utility bill has been fully paid.</p>
              <a
                href="/utilityBills/<%= utils.unit_id %>"
                class="btn btn-primary"
              >
                ← Back to Bills
              </a>
            </div>
          </div>
          <% } %>
        </div>
      </div>
    </div>

    <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script>
      const paymentForm = document.getElementById("paymentForm");

      // Form validation
      paymentForm.addEventListener("submit", function (e) {
        const paymentAmount = document.getElementById("payment_amount").value;

        if (paymentAmount <= 0) {
          e.preventDefault();
          alert("Payment amount must be greater than zero");
          return false;
        }

        return confirm(`Confirm payment of ₱${paymentAmount.toFixed(2)}?`);
      });
    </script>
  </body>
</html>
