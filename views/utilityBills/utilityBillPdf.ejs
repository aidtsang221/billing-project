<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Utility Bill PDF</title>
    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0.5in 1in;
        font-size: 11pt;
        color: #333;
      }
      .container {
        max-width: 700px;
        margin: 0 auto;
      }
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        color: #2c3e50;
        margin-top: 1.2em;
        margin-bottom: 0.5em;
      }
      .header,
      .footer {
        text-align: center;
        margin-bottom: 1.5em;
        border-bottom: 1px solid #eee;
        padding-bottom: 1em;
      }
      .footer {
        margin-top: 2em;
        border-top: 1px solid #eee;
        border-bottom: none;
        padding-top: 1em;
        font-size: 8pt;
        color: #777;
      }
      .summary-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1.5em;
      }
      .summary-table th,
      .summary-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      .summary-table th {
        background-color: #f2f2f2;
      }
      .total-amount {
        font-size: 1.2em;
        font-weight: bold;
        text-align: right;
        margin-top: 1em;
      }
      .text-muted {
        color: #6c757d !important;
      }
      .bldg-name {
        font-size: 1.3em;
        font-weight: bold;
        color: #2c3e50;
      }
      .charges-title {
        font-size: 1.1em;
        font-weight: bold;
        margin-top: 1em;
        margin-bottom: 0.5em;
        color: #444;
      }
      .banner {
        width: 100%;
        margin: 0;
        padding: 0;
      }

      .banner .logo {
        width: 100%;
        height: 120px;
        object-fit: cover;
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="banner">
      <img
        src="http://localhost:3000/images/logo.jpg"
        alt="Royal Peak Logo"
        class="logo"
      />
    </div>
    <div class="container">
      <div class="header">
        <h2>Utility Bills Summary</h2>
      </div>

      <%= %> <% if (util.length > 0) { %>
      <div class="mb-5">
        <!-- <h5 class="bldg-name"><%= util[0].bldg_name %></h5> -->
        <p><strong>Unit</strong>: <%= util[0].unit_no %></p>
        <p><strong>Owner</strong>: <%= util[0].owner_name %></p>
      </div>
      <% } %>

      <div class="row">
        <% %> <% util.forEach((utilities, index) => { %>
        <div class="col-6 mb-4">
          <div class="p-3 border rounded">
            <h3 class="text-center mb-3">
              <%= utilities.category.toUpperCase() %> Bill
            </h3>

            <p>SORE<%= utilities.util_id %></p>
            <p>
              <strong>Bill Period:</strong>
              <%= new Date(utilities.start_date).toLocaleDateString('en-US', {
              year:'numeric', month:'long', day:'numeric' }) %> to <%= new
              Date(utilities.end_date).toLocaleDateString('en-US', {
              year:'numeric', month:'long', day:'numeric' }) %>
            </p>
            <p>
              <strong>Due Date:</strong>
              <%= new Date(utilities.due_date).toLocaleDateString('en-US', {
              year:'numeric', month:'long', day:'numeric' }) %>
            </p>
            <% if(utilities.category == 'water' || utilities.category ==
            'electricity') { %>
            <p>
              <strong>Rate:</strong>
              <%= parseFloat(utilities.rate).toLocaleString('en-US', {
              minimumFractionDigits: 2, maximumFractionDigits: 2 }) %> <% if
              (utilities.category === 'water') { %> / m<sup>3</sup> <% } else if
              (utilities.category === 'electricity') { %> / kWh <% } %>
            </p>
            <% } %>

            <h6 class="charges-title">Charges Breakdown</h6>
            <table class="summary-table">
              <tbody>
                <% if(utilities.category == 'water' || utilities.category ==
                'electricity') { %>
                <tr>
                  <td>Previous Reading</td>
                  <td>
                    <%=
                    parseFloat(utilities.prev_reading).toLocaleString('en-US', {
                    minimumFractionDigits: 2, maximumFractionDigits: 2 }) %>
                  </td>
                </tr>
                <tr>
                  <td>Current Reading</td>
                  <td>
                    <%=
                    parseFloat(utilities.curr_reading).toLocaleString('en-US', {
                    minimumFractionDigits: 2, maximumFractionDigits: 2 }) %>
                  </td>
                </tr>
                <tr>
                  <td>Total Consumption</td>
                  <td>
                    <%= parseFloat(utilities.curr_reading -
                    utilities.prev_reading).toLocaleString('en-US', {
                    minimumFractionDigits: 2, maximumFractionDigits: 2 }) %>
                  </td>
                </tr>
                <% } else { %>
                <tr>
                  <td colspan="2" class="text-center">
                    <strong>Internet Rate:</strong> ₱<%=
                    parseFloat(utilities.rate).toLocaleString('en-US', {
                    minimumFractionDigits: 2, maximumFractionDigits: 2 }) %>
                  </td>
                </tr>
                <% } %>
              </tbody>
            </table>

            <div class="total-amount mt-3">
              Total Amount Due:
              <span style="font-size: 1.2em">
                ₱<%= parseFloat(utilities.total_amt).toLocaleString('en-US', {
                minimumFractionDigits: 2, maximumFractionDigits: 2 }) %>
              </span>
            </div>
          </div>
        </div>

        <% if ((index + 1) % 2 === 0) { %>
      </div>
      <div class="row">
        <!-- force new row after 2 bills -->
        <% } %> <% }) %>
      </div>

      <div class="footer">
        <p><%= new Date().toLocaleString() %></p>
      </div>
    </div>

    <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
